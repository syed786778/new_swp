<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SWP Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f9f9f9;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
    #report {
      margin-top: 40px;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #00bfa5;
      color: white;
    }
    #chartContainer {
      margin-top: 30px;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Systematic Withdrawal Plan (SWP) Calculator</h2>
  <label for="name">Customer Name:</label>
  <input type="text" id="name">

  <label for="corpus">Initial Corpus (₹):</label>
  <input type="number" id="corpus">

  <label for="return">Expected Annual Return (%):</label>
  <input type="number" id="return">

  <label for="withdrawal">Monthly Withdrawal (₹):</label>
  <input type="number" id="withdrawal">

  <label for="inflation">Expected Inflation Rate (%):</label>
  <input type="number" id="inflation">

  <label for="years">Duration (Years):</label>
  <input type="number" id="years">

  <button onclick="calculateSWP()">Calculate</button>
  <button onclick="downloadPDF()">Download PDF Report</button>

  <div id="report"></div>
  <div id="chartContainer">
    <canvas id="corpusChart"></canvas>
  </div>
</div>

<script>
  let chart;

  function calculateSWP() {
    const name = document.getElementById('name').value;
    const corpus = parseFloat(document.getElementById('corpus').value);
    const annualReturn = parseFloat(document.getElementById('return').value) / 100;
    const monthlyReturn = Math.pow(1 + annualReturn, 1/12) - 1;
    const withdrawal = parseFloat(document.getElementById('withdrawal').value);
    const inflationRate = parseFloat(document.getElementById('inflation').value) / 100;
    const durationYears = parseInt(document.getElementById('years').value);
    const totalMonths = durationYears * 12;

    let balance = corpus;
    let months = 0;
    let exhaustedIn = null;
    const data = [];

    for (let i = 0; i < totalMonths; i++) {
      const inflationAdjustedWithdrawal = withdrawal * Math.pow(1 + inflationRate, i / 12);
      balance = balance * (1 + monthlyReturn) - inflationAdjustedWithdrawal;
      if (balance <= 0 && !exhaustedIn) {
        exhaustedIn = i;
        balance = 0;
      }
      data.push({ month: i, balance });
    }

    const yearsExhausted = exhaustedIn ? (exhaustedIn / 12).toFixed(1) + ' years' : 'Not exhausted';

    document.getElementById('report').innerHTML = `
      <h3>Systematic Withdrawal Plan Report</h3>
      <p><strong>Customer Name:</strong> ${name}</p>
      <table>
        <tr><th>Field</th><th>Value</th></tr>
        <tr><td>Initial Corpus</td><td>₹ ${corpus.toLocaleString()}</td></tr>
        <tr><td>Annual Return</td><td>${(annualReturn * 100).toFixed(2)}%</td></tr>
        <tr><td>Monthly Withdrawal</td><td>₹ ${withdrawal.toLocaleString()}</td></tr>
        <tr><td>Inflation Rate</td><td>${(inflationRate * 100).toFixed(2)}%</td></tr>
        <tr><td>Duration</td><td>${durationYears} years</td></tr>
      </table>
      <p><strong>Corpus exhausted in:</strong> ${yearsExhausted}</p>
    `;

    const ctx = document.getElementById('corpusChart').getContext('2d');
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.map(d => (d.month / 12).toFixed(1)),
        datasets: [{
          label: 'Corpus Balance Over Time',
          data: data.map(d => d.balance),
          borderColor: '#007bff',
          fill: false,
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: { title: { display: true, text: 'Year' } },
          y: { title: { display: true, text: 'Corpus (₹)' } }
        }
      }
    });
  }

  function downloadPDF() {
    const {{ jsPDF }} = window.jspdf;
    const doc = new jsPDF();

    const name = document.getElementById('name').value;
    const corpus = document.getElementById('corpus').value;
    const annualReturn = document.getElementById('return').value;
    const withdrawal = document.getElementById('withdrawal').value;
    const inflation = document.getElementById('inflation').value;
    const years = document.getElementById('years').value;

    const canvas = document.getElementById('corpusChart');
    const chartImg = canvas.toDataURL("image/png", 1.0);

    doc.setFontSize(14);
    doc.text("Systematic Withdrawal Plan Report", 20, 20);
    doc.setFontSize(12);
    doc.text(`Customer Name: ${name}`, 20, 30);
    doc.text(`Initial Corpus: ₹ ${corpus}`, 20, 40);
    doc.text(`Annual Return: ${annualReturn}%`, 20, 50);
    doc.text(`Monthly Withdrawal: ₹ ${withdrawal}`, 20, 60);
    doc.text(`Inflation Rate: ${inflation}%`, 20, 70);
    doc.text(`Duration: ${years} years`, 20, 80);

    const reportText = document.getElementById('report').innerText;
    const exhaustedLine = reportText.split('\n').find(line => line.includes('Corpus exhausted'));
    doc.text(exhaustedLine, 20, 90);

    doc.addImage(chartImg, 'PNG', 15, 100, 180, 80);
    doc.save('SWP_Report.pdf');
  }
</script>
</body>
</html>
